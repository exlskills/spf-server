<script>
    var wsusi = {ws: new WebSocket('{{config.wsUSIEndpoint}}')};
    wsusi.ws.onclose = function(){
        // Try to reconnect in 5 seconds
        setTimeout(function(){wsusi.ws = new WebSocket('{{config.wsUSIEndpoint}}')}, 2000);
    };
    var wsusiWaitForConnection = (callback, interval) => {
        if (wsusi.ws.readyState === 1) {
            callback()
        } else if (wsusi.ws.readyState === 3) {
            wsusi.ws = new WebSocket('{{config.wsUSIEndpoint}}');
            setTimeout(() => {
                wsusiWaitForConnection(callback, interval)
            }, 2000);
        } else {
            // optional: implement backoff for interval here
            setTimeout(() => {
                wsusiWaitForConnection(callback, interval)
            }, interval)
        }
    }
    wsusi.sendNotification = function(eventType, data) {
        wsusiWaitForConnection(function() {
            return wsusi.ws.send(
                    JSON.stringify({
                        type: 'notif',
                        payload: {
                            event: eventType,
                            data
                        }
                    })
            )
        }, 500);
    };
</script>